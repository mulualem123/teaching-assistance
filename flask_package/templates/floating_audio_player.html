<!-- Floating Audio Player Component -->
<div class="floating-audio-player hidden" id="floatingAudioPlayer">
    <div class="audio-controls">
        <button class="btn btn-sm btn-outline-secondary" id="prevBtn" title="Previous">
            <i class="bi bi-skip-backward-fill"></i>
        </button>
        <button class="btn btn-sm btn-primary" id="playPauseBtn" title="Play/Pause">
            <i class="bi bi-play-fill"></i>
        </button>
        <button class="btn btn-sm btn-outline-secondary" id="nextBtn" title="Next">
            <i class="bi bi-skip-forward-fill"></i>
        </button>
        
        <div class="progress-container">
            <div class="progress">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
            <small class="text-muted">
                <span id="currentTime">0:00</span> / <span id="totalTime">0:00</span>
            </small>
        </div>
        
        <button class="btn btn-sm btn-outline-secondary" id="stopBtn" title="Stop">
            <i class="bi bi-stop-fill"></i>
        </button>
        <button class="btn btn-sm btn-outline-secondary" id="closeBtn" title="Close">
            <i class="bi bi-x-lg"></i>
        </button>
        <button class="btn btn-sm btn-outline-secondary minimize-btn" id="minimizeBtn" title="Minimize">
            <i class="bi bi-dash-lg"></i>
        </button>
    </div>
    
    <div class="song-info mt-2">
        <small class="fw-bold" id="currentSongTitle">No song playing</small>
    </div>
</div>

<!-- Enhanced Playlist Modal with Minimization -->
<div class="modal fade" id="enhancedPlaylistModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ðŸŽµ <span id="enhancedPlaylistName">My Playlist</span></h5>
                <div>
                    <button class="btn btn-sm btn-outline-secondary me-1" id="minimizeModalBtn" title="Minimize">
                        <i class="bi bi-dash-lg"></i>
                    </button>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-8">
                        <!-- Enhanced Lyrics Section with Toggle -->
                        <div class="card mb-3">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">Lyrics</h6>
                                <button class="btn btn-sm btn-outline-secondary lyrics-toggle" id="lyricsToggleBtn">
                                    <i class="bi bi-chevron-up"></i>
                                </button>
                            </div>
                            <div class="card-body lyrics-content expanded" id="lyricsContent">
                                <div id="enhancedColapGeez"></div>
                                <div id="enhancedColapLatin"></div>
                                <div id="enhancedColapEnglish"></div>
                            </div>
                        </div>
                        
                        <!-- Enhanced Audio Player -->
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Audio Player</h6>
                            </div>
                            <div class="card-body">
                                <audio id="enhancedAudioPlayer" controls class="w-100">
                                    Your browser does not support the audio element.
                                </audio>
                                
                                <!-- Enhanced Controls -->
                                <div class="d-flex justify-content-center gap-2 mt-3">
                                    <button class="btn btn-outline-primary" id="enhancedPrevBtn">
                                        <i class="bi bi-skip-backward-fill"></i> Previous
                                    </button>
                                    <button class="btn btn-primary" id="enhancedPlayPauseBtn">
                                        <i class="bi bi-play-fill"></i> Play
                                    </button>
                                    <button class="btn btn-outline-primary" id="enhancedNextBtn">
                                        <i class="bi bi-skip-forward-fill"></i> Next
                                    </button>
                                    <button class="btn btn-outline-secondary" id="enhancedStopBtn">
                                        <i class="bi bi-stop-fill"></i> Stop
                                    </button>
                                    <button class="btn btn-outline-danger" id="enhancedCloseBtn">
                                        <i class="bi bi-x-lg"></i> Close
                                    </button>
                                </div>
                                
                                <!-- Progress Bar -->
                                <div class="mt-3">
                                    <div class="progress">
                                        <div class="progress-bar" id="enhancedProgressBar" style="width: 0%"></div>
                                    </div>
                                    <div class="d-flex justify-content-between mt-1">
                                        <small id="enhancedCurrentTime">0:00</small>
                                        <small id="enhancedTotalTime">0:00</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="playlist-actions">
                            <button class="btn btn-outline-primary w-100 mb-2" id="enhancedPlayAllBtn">
                                <i class="bi bi-play-fill"></i> Play All
                            </button>
                            <button class="btn btn-outline-success w-100 mb-2" data-bs-toggle="modal" data-bs-target="#sharePlaylistModal">
                                <i class="bi bi-share-fill"></i> Share
                            </button>
                            <textarea class="form-control mb-2" placeholder="Add spiritual reflections..."></textarea>
                        </div>
                        
                        <!-- Playlist Songs -->
                        <div id="enhancedPlaylistSongs" class="list-group">
                            <!-- Songs will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Enhanced Audio Player JavaScript
let enhancedPlayer = {
    audio: null,
    isPlaying: false,
    currentIndex: 0,
    songs: [],
    playlistId: null,
    isMinimized: false
};

function initializeEnhancedPlayer() {
    // Create floating audio player
    const floatingPlayer = document.getElementById('floatingAudioPlayer');
    if (!floatingPlayer) return;

    // Initialize audio element
    enhancedPlayer.audio = document.getElementById('enhancedAudioPlayer');
    
    // Setup event listeners
    document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);
    document.getElementById('enhancedPlayPauseBtn').addEventListener('click', togglePlayPause);
    document.getElementById('stopBtn').addEventListener('click', stopAudio);
    document.getElementById('enhancedStopBtn').addEventListener('click', stopAudio);
    document.getElementById('closeBtn').addEventListener('click', closeAudio);
    document.getElementById('enhancedCloseBtn').addEventListener('click', closeAudio);
    document.getElementById('minimizeBtn').addEventListener('click', minimizePlayer);
    document.getElementById('minimizeModalBtn').addEventListener('click', minimizeModal);
    document.getElementById('lyricsToggleBtn').addEventListener('click', toggleLyrics);
    
    // Progress bar updates
    enhancedPlayer.audio.addEventListener('timeupdate', updateProgress);
    enhancedPlayer.audio.addEventListener('loadedmetadata', updateDuration);
}

function togglePlayPause() {
    if (enhancedPlayer.isPlaying) {
        enhancedPlayer.audio.pause();
        enhancedPlayer.isPlaying = false;
        updatePlayPauseButtons('play');
    } else {
        enhancedPlayer.audio.play();
        enhancedPlayer.isPlaying = true;
        updatePlayPauseButtons('pause');
    }
}

function updatePlayPauseButtons(state) {
    const playBtn = document.getElementById('playPauseBtn');
    const enhancedPlayBtn = document.getElementById('enhancedPlayPauseBtn');
    
    if (state === 'play') {
        playBtn.innerHTML = '<i class="bi bi-play-fill"></i>';
        enhancedPlayBtn.innerHTML = '<i class="bi bi-play-fill"></i> Play';
    } else {
        playBtn.innerHTML = '<i class="bi bi-pause-fill"></i>';
        enhancedPlayBtn.innerHTML = '<i class="bi bi-pause-fill"></i> Pause';
    }
}

function stopAudio() {
    enhancedPlayer.audio.pause();
    enhancedPlayer.audio.currentTime = 0;
    enhancedPlayer.isPlaying = false;
    updatePlayPauseButtons('play');
}

function closeAudio() {
    stopAudio();
    hideFloatingPlayer();
    const modal = bootstrap.Modal.getInstance(document.getElementById('enhancedPlaylistModal'));
    if (modal) modal.hide();
}

function minimizePlayer() {
    const modal = bootstrap.Modal.getInstance(document.getElementById('enhancedPlaylistModal'));
    if (modal) modal.hide();
    showFloatingPlayer();
}

function minimizeModal() {
    const modal = bootstrap.Modal.getInstance(document.getElementById('enhancedPlaylistModal'));
    if (modal) modal.hide();
    showFloatingPlayer();
}

function showFloatingPlayer() {
    const player = document.getElementById('floatingAudioPlayer');
    player.classList.remove('hidden');
}

function hideFloatingPlayer() {
    const player = document.getElementById('floatingAudioPlayer');
    player.classList.add('hidden');
}

function toggleLyrics() {
    const content = document.getElementById('lyricsContent');
    const toggleBtn = document.getElementById('lyricsToggleBtn');
    const icon = toggleBtn.querySelector('i');
    
    if (content.classList.contains('expanded')) {
        content.classList.remove('expanded');
        content.classList.add('collapsed');
        icon.className = 'bi bi-chevron-down';
    } else {
        content.classList.remove('collapsed');
        content.classList.add('expanded');
        icon.className = 'bi bi-chevron-up';
    }
}

function updateProgress() {
    const progress = (enhancedPlayer.audio.currentTime / enhancedPlayer.audio.duration) * 100;
    document.getElementById('progressBar').style.width = progress + '%';
    document.getElementById('enhancedProgressBar').style.width = progress + '%';
    
    const currentTime = formatTime(enhancedPlayer.audio.currentTime);
    document.getElementById('currentTime').textContent = currentTime;
    document.getElementById('enhancedCurrentTime').textContent = currentTime;
}

function updateDuration() {
    const duration = formatTime(enhancedPlayer.audio.duration);
    document.getElementById('totalTime').textContent = duration;
    document.getElementById('enhancedTotalTime').textContent = duration;
}

function formatTime(seconds) {
    if (isNaN(seconds)) return '0:00';
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', initializeEnhancedPlayer);
</script>
